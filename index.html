
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="base_image/">
      
      
      <link rel="icon" href="images/favicon.svg">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.24">
    
    
      
        <title>Vertex pipelines starter kit</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oxygen:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Oxygen";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="stylesheets/skaff.css">
    
      <link rel="stylesheet" href="termynal.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-7REH78BCSD"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-7REH78BCSD",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-7REH78BCSD",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#vertex-pipelines-starter-kit" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Vertex pipelines starter kit" class="md-header__button md-logo" aria-label="Vertex pipelines starter kit" data-md-component="logo">
      
  <img src="images/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Vertex pipelines starter kit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="custom" data-md-color-accent="custom"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/artefactory/vertex-pipeline-starter-kit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    artefactory/vertex-pipeline-starter-kit
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Vertex pipelines starter kit" class="md-nav__button md-logo" aria-label="Vertex pipelines starter kit" data-md-component="logo">
      
  <img src="images/logo.svg" alt="logo">

    </a>
    Vertex pipelines starter kit
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/artefactory/vertex-pipeline-starter-kit" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    artefactory/vertex-pipeline-starter-kit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Home
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#understanding-the-vertex-ai-platform" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding the Vertex AI platform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vertex-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Vertex pipelines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vertex pipelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convictions" class="md-nav__link">
    <span class="md-ellipsis">
      Convictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process-for-working-with-vertex-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Process for working with Vertex pipelines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Process for working with Vertex pipelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-notebook-exploration" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 1 - Notebook exploration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-refactor-your-notebook-for-it-to-look-like-a-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 2 - Refactor your notebook for it to look like a pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-move-your-code-to-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 3 - Move your code to libraries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-wrap-this-code-in-components-and-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 4 - Wrap this code in components and pipelines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-iterate-and-improve" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 5 - Iterate and improve
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="base_image/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Docker base image for pipelines
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="managing_packages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Managing python packages and dependencies
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="managing_pipeline_configuration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Managing pipelines configurations
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="parallelizing_processing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Parallelizing processings in pipelines
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="splitting_components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rules of thumb to split components
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="when_to_use_premade_components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using premade components
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    How-tos
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            How-tos
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="howto_CPU_RAM_resources/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to allocate more RAM and CPU in a pipeline?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="howto_pass_complex_objects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to pass a complex object between components?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="howto_conditional_components/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to condition the execution of a component?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="howto_act_on_failure/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to trigger an alert when my vertex pipeline fails?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="howto_schedule_pipelines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to schedule pipelines?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="howto_gpu/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to manage GPUs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="howto_bentoml/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to create an API endpoint for online serving with BentoML
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#understanding-the-vertex-ai-platform" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding the Vertex AI platform
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#vertex-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Vertex pipelines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Vertex pipelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#convictions" class="md-nav__link">
    <span class="md-ellipsis">
      Convictions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#process-for-working-with-vertex-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Process for working with Vertex pipelines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Process for working with Vertex pipelines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#phase-1-notebook-exploration" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 1 - Notebook exploration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-2-refactor-your-notebook-for-it-to-look-like-a-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 2 - Refactor your notebook for it to look like a pipeline
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-3-move-your-code-to-libraries" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 3 - Move your code to libraries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-4-wrap-this-code-in-components-and-pipelines" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 4 - Wrap this code in components and pipelines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#phase-5-iterate-and-improve" class="md-nav__link">
    <span class="md-ellipsis">
      Phase 5 - Iterate and improve
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="vertex-pipelines-starter-kit">Vertex pipelines starter kit</h1>
<p>This repository template is meant to help Vertex pipelines beginners understand and avoid its pitfalls. It illustrates what we find is the most efficient way to transition from notebook exploration to a reliable, industrialized ML pipeline.</p>
<p>It is based on the collective knowledge and feedbacks of past Artefact projects and people. It is meant to illustrate an architecture that provides both iteration/exploration speed, as well as reliability for industrialisation.</p>
<p>It also touches on patterns that we have seen not work well or had worse velocity and reliability in our experience.</p>
<h2 id="understanding-the-vertex-ai-platform">Understanding the Vertex AI platform</h2>
<p>Before we start, it is important to mention the difference between Vertex AI and Vertex AI Pipelines. Vertex AI is a set of services gathered in a unified platform to accelerate data science projects: Vertex AI Dataset, Vertex AI Pipelines, Vertex AI endpoints, etc... Vertex AI Pipelines is one of the service included in the Vertex AI platform.</p>
<h2 id="vertex-pipelines">Vertex pipelines</h2>
<p>So, what are Vertex AI Pipelines?</p>
<p>Vertex AI Pipelines is a managed service offered by GCP to execute Kubeflow Pipelines.</p>
<p>If you separate all your machine learning workflow into “components” representing each steps of your ML workflow, then you can write your workflow using Kubeflow Pipelines SDK. In return, Kubeflow Pipeline makes your workflow portable and scalable.</p>
<p>Vertex AI Pipeline is a managed service to run your Kubeflow Pipelines.</p>
<h3 id="convictions">Convictions</h3>
<p>Kubeflow pipelines is a very powerful tool, but it is also very complex. On top of that you will be using it in a managed environment, which steepens the learning curve. To make developping vertex pipelines less painful, our main recommandation is to structure your code in a way that will allow you to work just like you would in a regular python project, and only use Vertex pipelines for orchestration and nothing else.</p>
<p>We want a strict eparation of concerns between the application code that does the data science, and the Vertex pipeline that will run it in an industrialized context.</p>
<p>On top of that, there are two big issues that we address with this starter kit:</p>
<ul>
<li>Vertex Pipelines have a high execution time overhead. Your code in a pipeline component will have an incompressible 2 minutes startup time to provision resources. While it does not look like a lot, it absolutely kills development velocity and cycle time. You can not iterate quickly with a 2 minutes overhead for each execution.</li>
<li>Vertex Pipelines are very flexible and there are many ways to develop with them. Too many. Here we try to provide one way of working with the tool that reduces the pain of industrialisation while preserving iteration speed during the exploration, development, and evolution of your ML pipeline.</li>
</ul>
<p>Here are our recommendation to avoid the problems above:</p>
<ul>
<li><strong>Use a single base docker image for all components.</strong> This is the environement your code will run in when in a pipeline. Don't lose time creating a tailor-made one for each component. Save time by having the same image with all the required dependencies and use it everywhere.</li>
<li><strong>Only use function-based components.</strong> Container-based components are much harder to build, deploy, and maintain. Use the slimmest possible function-based components to reduce your operational load.</li>
<li><strong>Embark as little intelligence as possible in the components.</strong> Enforcing a strong separation of concerns between your business and orchestration logic will allow you handle these two functionalities separately, making debugging easier and faster. </li>
<li><strong>Have the business logic concentrated in a regular python folder/files structure.</strong> This will facilitate the separation of concerns, allow you to run your code locally, unit-test it easily, etc...</li>
<li><strong>This code should be locally executable.</strong> Essential to be able to quickly iterate on it.</li>
</ul>
<h2 id="process-for-working-with-vertex-pipelines">Process for working with Vertex pipelines</h2>
<p>Here we describe a workflow we have tested and recommend when using vertex pipelines. 
An example of following this workflow is included in this repository
(final pipeline output is <code>vertex/pipelines/my_first_pipeline.py</code> )</p>
<p>Note that if you are not a fan of jupyter notebooks you can easily replace notebooks with scripts for a similar workflow</p>
<h3 id="phase-1-notebook-exploration">Phase 1 - Notebook exploration</h3>
<ul>
<li>Do your usual notebook things, maybe start thinking about writing functions, but no pressure.</li>
</ul>
<h3 id="phase-2-refactor-your-notebook-for-it-to-look-like-a-pipeline">Phase 2 - Refactor your notebook for it to look like a pipeline</h3>
<ul>
<li>Wrap code in functions to make them easily transferable to scripts</li>
<li>Write your Notebook in a way that will mirror an ML pipeline: a section for a pipeline step/component, the notebook itself could represent the pipeline.</li>
<li>When loading data from files, or tables to pandas dataframe, make sure to explicitly cast to the types that you will use (for cases which are ambiguous). Vertex has a way of loading data that may produce similar but different data types.</li>
<li>Type hint functions inputs/outputs as a general good practice and to identify at a glance the vertex-compatible ones</li>
</ul>
<h3 id="phase-3-move-your-code-to-libraries">Phase 3 - Move your code to libraries</h3>
<ul>
<li>Migrate main and subfunctions to a <code>lib</code> folder. </li>
<li>Those functions will be called both: </li>
<li>In your notebook for iterating and testing new features</li>
<li>By your vertex components for running the pipelines</li>
<li>At this point your notebook should only include import, some config definition and application of your main functions.</li>
<li>Have clear entrypoint functions to then use in components</li>
<li>Maybe even write a few unit/integration tests</li>
<li>Have a fully functional workflow before even thinking of moving to Vertex Pipelines</li>
<li><code>notebooks/vertex_pipelines/my_first_pipeline.ipynb</code> gives an example of how do this for a simple ETL</li>
</ul>
<p>Example of pipeline notebook for a simple ETL (each section is a component):
<img alt="" src="assets/notebook_pipeline.png" /></p>
<h3 id="phase-4-wrap-this-code-in-components-and-pipelines">Phase 4 - Wrap this code in components and pipelines</h3>
<ul>
<li>Now we are finally doing some vertex ! </li>
<li>Write your function based components, you should only load / save your data (as this is vertex specific code) and import and call your top-level functions. Again, if you find yourself writing business or technical logic in the component, you should think about moving it to your <code>lib</code></li>
<li>Finally, you can compose your pipeline from the components that you defined.</li>
<li>Run your pipeline, and hope for the best.</li>
</ul>
<div class="admonition example">
<p class="admonition-title">transform_data Component</p>
<div class="highlight"><pre><span></span><code><span class="nd">@component</span><span class="p">(</span><span class="n">base_image</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;europe-west1-docker.pkg.dev/</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;PROJECT_ID&quot;</span><span class="p">)</span><span class="si">}</span><span class="s1">/vertex-pipelines-docker/vertex-pipelines-base:latest&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">transform_data_component</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">Input</span><span class="p">[</span><span class="n">Dataset</span><span class="p">],</span>
    <span class="n">column_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">constant_value</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">df_transformed_dataset</span><span class="p">:</span> <span class="n">Output</span><span class="p">[</span><span class="n">Dataset</span><span class="p">]</span>
<span class="p">):</span>
    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="kn">from</span> <span class="nn">vertex.lib.processors.transform_data</span> <span class="kn">import</span> <span class="n">add_constant_column</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">uri</span><span class="p">)</span>
    <span class="n">df_transformed</span> <span class="o">=</span> <span class="n">add_constant_column</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">column_name</span><span class="p">,</span> <span class="n">constant_value</span><span class="p">)</span>
    <span class="n">df_transformed</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">df_transformed_dataset</span><span class="o">.</span><span class="n">uri</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
</div>
<h3 id="phase-5-iterate-and-improve">Phase 5 - Iterate and improve</h3>
<p>You are probably going to need to go back to phase 1 to iterate and go through the motions again, from notebook to running pipeline. This is expected and normal. Doing it often will make you think end-to-end and allow you to close the feedback loop with users, thus limiting tunnel effect. It will also highlight potential integration risks within and around the pipeline early on. See: Walking skeleton approach.</p>
<p>It is a very good idea to keep maintaining the notebooks you used for creating a pipeline so that they can be used for quickly updating existing pipeline :  modify your libs test in the notebook and once everything is working, test with vertex. </p>









  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1@">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M5 9v12H1V9h4m4 12a2 2 0 0 1-2-2V9c0-.55.22-1.05.59-1.41L14.17 1l1.06 1.06c.27.27.44.64.44 1.05l-.03.32L14.69 8H21a2 2 0 0 1 2 2v2c0 .26-.05.5-.14.73l-3.02 7.05C19.54 20.5 18.83 21 18 21H9m0-2h9.03L21 12v-2h-8.79l1.13-5.32L9 9.03V19Z"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 15V3h4v12h-4M15 3a2 2 0 0 1 2 2v10c0 .55-.22 1.05-.59 1.41L9.83 23l-1.06-1.06c-.27-.27-.44-.64-.44-1.06l.03-.31.95-4.57H3a2 2 0 0 1-2-2v-2c0-.26.05-.5.14-.73l3.02-7.05C4.46 3.5 5.17 3 6 3h9m0 2H5.97L3 12v2h8.78l-1.13 5.32L15 14.97V5Z"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1@" hidden>
              
              
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              Thanks for your feedback! Help us improve this page by  <a href="https://github.com/artefactory-skaff/skaff-repo-template/issues/new/?title=[Feedback]+Home+-+/" target="_blank" rel="noopener">opening an issue</a>.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["search.suggest", "search.highlight", "content.code.annotate", "content.code.copy", "content.code.select", "navigation.indexes", "navigation.path", "navigation.instant", "navigation.instant.preview", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.tracking", "toc.follow"], "search": "assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.081f42fc.min.js"></script>
      
        <script src="termynal.js"></script>
      
    
  </body>
</html>